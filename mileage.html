<!doctype html>
<html>
<head><meta charset="utf-8"><title>Mileage</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"></head>
<body class="bg-light">
<div class="container py-4">
  <a href="dashboard.html" class="btn btn-link">‚Üê Back</a>
  <h3>Mileage Entry</h3>
  <form id="fm" class="mb-3">
    <div class="row g-2">
      <div class="col-md-3"><select id="vehicleSelect" name="vehicleId" class="form-select" required></select></div>
      <div class="col-md-3"><select id="driverSelect2" name="driverId" class="form-select" required></select></div>
      <div class="col-md-2"><input name="date" type="date" class="form-control" required></div>
      <div class="col-md-2"><input name="startReading" class="form-control" placeholder="Start"></div>
      <div class="col-md-2"><input name="endReading" class="form-control" placeholder="End"></div>
      <div class="col-md-12 mt-2"><button class="btn btn-primary">Save Mileage</button></div>
    </div>
  </form>
  <div id="list"></div>
</div>
<script>
if(!localStorage.token) location='login.html';
const headers={ 'Content-Type':'application/json','Authorization':'Bearer '+localStorage.token };
async function loadSelects(){ const r1=await fetch('riderevenue-backend.onrender.com/api/vehicles',{headers}); const v=await r1.json(); document.getElementById('vehicleSelect').innerHTML = v.map(x=>`<option value="${x.VehicleID}">${x.NumberPlate}</option>`).join(''); const r2=await fetch('riderevenue-backend.onrender.com/api/drivers',{headers}); const d=await r2.json(); document.getElementById('driverSelect2').innerHTML = d.map(x=>`<option value="${x.DriverID}">${x.Name}</option>`).join(''); }
document.getElementById('fm').addEventListener('submit', async e=>{ e.preventDefault(); const f=e.target; const body={ vehicleId: parseInt(f.vehicleId.value), driverId: parseInt(f.driverId.value), date: f.date.value, startReading: parseInt(f.startReading.value), endReading: parseInt(f.endReading.value) }; const res=await fetch('riderevenue-backend.onrender.com/api/mileage',{method:'POST',headers,body:JSON.stringify(body)}); if(res.ok){ loadList(); f.reset(); } else alert((await res.json()).message); });
async function loadList(){ const r=await fetch('riderevenue-backend.onrender.com/api/mileage',{headers}); const data=await r.json(); document.getElementById('list').innerHTML = `<table class="table"><thead><tr><th>Date</th><th>Vehicle</th><th>Driver</th><th>Start</th><th>End</th><th>Distance</th></tr></thead><tbody>${data.map(m=>`<tr><td>${m.Date}</td><td>${m.NumberPlate||''}</td><td>${m.DriverName||''}</td><td>${m.StartReading}</td><td>${m.EndReading}</td><td>${m.Distance}</td></tr>`).join('')}</tbody></table>`; }
loadSelects(); loadList();
</script>
</body>
</html>
