<!DOCTYPE html>
<html>
<head>
    <title>Add Daily Log</title>
</head>
<body>
    <h2>Add Daily Log</h2>

    <form id="dailyLogForm">

        <label>Driver:</label>
        <select id="driver_id" required></select><br><br>

        <label>Vehicle:</label>
        <select id="vehicle_id" required></select><br><br>

        <label>Shift:</label>
        <select id="shift" required>
            <option value="Morning">Morning</option>
            <option value="Evening">Evening</option>
            <option value="Night">Night</option>
        </select><br><br>

        <label>Date:</label>
        <input type="date" id="date" required><br><br>

        <label>Mileage:</label>
        <input type="number" id="mileage" required><br><br>

        <label>Earnings:</label>
        <input type="number" id="earnings" required><br><br>

        <button type="submit">Save Log</button>
    </form>

    <p id="msg"></p>

    <script>
        const api = 'https://riderevenue-backend.onrender.com/api';

        async function loadDropdowns() {

            const drivers = await fetch(`${API}/drivers/all`).then(r => r.json());
            const vehicles = await fetch(`${API}/vehicles/all`).then(r => r.json());

            const d = document.getElementById("driver_id");
            const v = document.getElementById("vehicle_id");

            drivers.forEach(x => {
                d.innerHTML += `<option value="${x.id}">${x.name}</option>`;
            });

            vehicles.forEach(x => {
                v.innerHTML += `<option value="${x.id}">${x.number}</option>`;
            });
        }

        loadDropdowns();

        document.getElementById("dailyLogForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                driver_id: document.getElementById("driver_id").value,
                vehicle_id: document.getElementById("vehicle_id").value,
                shift: document.getElementById("shift").value,
                date: document.getElementById("date").value,
                mileage: document.getElementById("mileage").value,
                earnings: document.getElementById("earnings").value
            };

            const res = await fetch(`${API}/dailylogs/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            const result = await res.json();

            document.getElementById("msg").innerText = result.message;
        });
    </script>
</body>
</html>
